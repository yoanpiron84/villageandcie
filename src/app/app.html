<div class="auth-container">

  <!-- LOGIN FORM -->
  <div *ngIf="!(auth.isAuthenticated$ | async) && !showResetForm">
    <form [formGroup]="loginForm" (ngSubmit)="login()" class="login-form">
      <h1>Connectez-Vous</h1>

<!--      <input type="email" placeholder="Email" formControlName="email" required>-->
<!--      <input type="password" placeholder="Mot de passe" formControlName="password" required>-->

      <button type="submit" [disabled]="loginForm.invalid">Connexion</button>

      <button type="button" class="btn-google" (click)="loginWithGoogle()">
        Se connecter avec Google
      </button>

      <p class="forgot" (click)="showResetForm = true">
        Mot de passe oublié ?
      </p>
    </form>
  </div>

  <!-- RESET PASSWORD FORM -->
  <div *ngIf="showResetForm">
    <form [formGroup]="resetForm" (ngSubmit)="resetPasswordSubmit()" class="login-form">
      <h1>Réinitialiser le mot de passe</h1>

      <input type="email" placeholder="Votre email" formControlName="email" required>

      <button type="submit" [disabled]="resetForm.invalid">Envoyer le mail de réinitialisation</button>
      <button type="button" (click)="showResetForm = false">Annuler</button>

      <p *ngIf="resetSent" class="success-msg">Un email de réinitialisation a été envoyé.</p>
    </form>
  </div>

</div>


<!-- LOGGED-IN STATE -->
@if(auth.isAuthenticated$ | async){

  <!-- Sidebar -->
  <nav class="sidebar">
    <div class="logo">
      <img src="images/site-logo.png" alt="Logo" class="site-logo"/>
    </div>

    <!-- ✅ Sélecteur de langue intégré à la sidebar -->
    <div class="language-switcher">
      <button class="toggle-lang-btn" (click)="toggleLanguageMenu()">
        <img [src]="'/images/flags/' + languageService.currentLanguage + '.png'"
             [alt]="languageService.currentLanguage"
             class="flag-icon">
      </button>

      @if (showLanguageMenu){
        <div class="language-menu-card">
          <div class="language-option" (click)="changeLanguage('fr')">
            <img src="/images/flags/fr.png" alt="Français" class="flag-icon">
            <span>Français</span>
          </div>
          <div class="language-option" (click)="changeLanguage('en')">
            <img src="/images/flags/en.png" alt="English" class="flag-icon">
            <span>English</span>
          </div>
          <div class="language-option" (click)="changeLanguage('es')">
            <img src="/images/flags/es.png" alt="Español" class="flag-icon">
            <span>Español</span>
          </div>
        </div>
      }
    </div>

    <div class="menu-toggle" (click)="toggleMenu()">&#9776;</div>

    <ul class="sidebar-menu" [class.active]="menuActive">
      <li>
        <a id="logout-btn"
           (click)="auth.logout({ logoutParams: { returnTo: getWindow().location.origin } })"
           title="Déconnexion">
          <i class="fa fa-sign-out-alt menu-icon"></i>
          <span class="menu-text logout-text"> {{ translations['disconnect'] }}</span>
        </a>
      </li>
      <li>
        <a id="home-btn" (click)="toggleView('home')" title="Home">
          <i class="fa fa-home menu-icon"></i>
          <span class="menu-text home-text"> {{ translations['home'] }}</span>
        </a>
      </li>
      <li>
        <a id="map-btn" (click)="toggleView('map')" title="Carte">
          <i class="fa fa-map menu-icon"></i>
          <span class="menu-text map-text"> {{ translations['map'] }}</span>
        </a>
      </li>
      <li>
        <a id="chat-btn" (click)="toggleView('chat')" title="Chat IA">
          <i class="fa fa-comments menu-icon"></i>
          <span class="menu-text chat-text"> {{ translations['chat'] }}</span>
        </a>
      </li>
      <li>
        <a id="profile-btn" (click)="toggleView('profile')" title="Profil">
          <i class="fa fa-user menu-icon"></i>
          <span class="menu-text profile-text">{{ translations['profile'] }}</span>
        </a>
      </li>
    </ul>
  </nav>


  <!-- Main Content -->
  @if(showHome){
  <div class="main-content" [class.full-screen-map]="showMap">
    @if (!showMap){
      <header id="home" class="header-section">

        <h1 class="title" *ngIf="user">
          <span class="hide-small">{{ translations['welcome'] }} {{ user.name }} {{ translations['on'] }} Village&Cie</span>
        </h1>

        <p class="subtitle">{{ translations['discover_welcome'] }}</p><br><br>
        <div class="carousel-container">
          <div class="carousel-track" [style.transform]="'translateX(-' + currentSlide * 100 + '%)'" >
            @for (slide of slides; track slide.text){
              <div class="carousel-item">
                <img [src]="slide.image" alt="Slide">
                <div class="carousel-caption">{{slide.text}}</div>
              </div>
            }
          </div>

          <!-- Boutons navigation -->
          <button class="carousel-btn prev" (click)="prevSlide(true)">&#10094;</button>
          <button class="carousel-btn next" (click)="nextSlide(true)">&#10095;</button>
        </div>
      </header>
    }


<!--    @if (showMap){-->
<!--      <app-map #mapRef [translations]="translations" [currentLanguage]="currentLanguage" [showMap]="showMap"></app-map>-->
<!--    }-->
  </div>
  }

  @if (showMap){
    <div class="main-wrapper">
      <app-map #mapRef [translations]="translations" [showMap]="showMap"></app-map>
    </div>
  }

  <!-- Chat Flottant -->
  @if (showChat){
    <app-voice [mapComponent]="mapRef" [translations]="translations"></app-voice>
  }

  @if (showProfile){
    <div class="main-wrapper">
      <app-profile #profile [translations]="translations"></app-profile>
    </div>
  }

}
