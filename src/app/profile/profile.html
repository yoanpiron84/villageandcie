<div class="profile-page">
  <div class="profile-card">

    <!-- PHOTO -->
    <div class="profile-img-wrapper" [class.editing]="editingName">
      <img
        [src]="editingName ? tempPhoto || 'images/avatar-default.png' : userService.userSignal()?.picture || 'images/avatar-default.png'"
        alt="Photo de profil"
        class="profile-img"
      />


      <!-- Upload icon visible seulement en Ã©dition -->
      <label *ngIf="editingName" class="upload-icon" [attr.aria-label]="translations['tag:edit']?.message">
        <input type="file" (change)="onPhotoChange($event)" hidden />
        &#8682;
      </label>
    </div>

    <!-- NOM -->
    <div class="profile-name">
      <ng-container *ngIf="!editingName; else editNameTemplate">
        <h2>{{ userService.userSignal()?.name || translations['tag:profile_default_name']?.message }}</h2>

        <button type="button" class="edit-btn" (click)="toggleEditName()">
          {{ translations['tag:edit']?.message }}
        </button>
      </ng-container>

      <ng-template #editNameTemplate>
        <input
          [(ngModel)]="editedName"
          [placeholder]="translations['tag:edit_username_placeholder']?.message"
          [attr.aria-label]="translations['tag:edit_username_placeholder']?.message"
        />
        <div class="edit-buttons">
          <button type="button" class="save-btn" (click)="saveChanges()">
            {{ translations['tag:save']?.message }}
          </button>
          <button type="button" class="cancel-btn" (click)="cancelEdit()">
            {{ translations['tag:cancel']?.message }}
          </button>
        </div>
      </ng-template>
    </div>

    <!-- DETAILS UTILISATEUR -->
    <ng-container *ngIf="userService.userSignal() as user">
      <div class="profile-details">

        <div class="detail-row">
          <strong>{{ translations['tag:email']?.message }} :</strong>
          <span>{{ user.email || '-' }}</span>
        </div>

        <div class="detail-row">
          <strong>{{ translations['tag:email_verified']?.message }} :</strong>
          <span>{{ user.email_verified ? translations['tag:yes']?.message : translations['tag:no']?.message }}</span>
        </div>

        <div class="detail-row">
          <strong>{{ translations['tag:logins_count']?.message }} :</strong>
          <span>{{ user.logins_count ?? 0 }}</span>
        </div>

        <div class="detail-row">
          <strong>{{ translations['tag:account_created']?.message }} :</strong>
          <span>{{ normalizeDate(user.created_at) | date:'short' }}</span>
        </div>

        <div class="detail-row">
          <strong>{{ translations['tag:last_connection']?.message }} :</strong>
          <span>{{ normalizeDate(user.updated_at) | date:'short' }}</span>
        </div>

        <div class="detail-row">
          <strong>{{ translations['tag:language']?.message }} :</strong>
          <span>{{ user.locale || 'fr' }}</span>
        </div>

      </div>
    </ng-container>

  </div>
</div>
